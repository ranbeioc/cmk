/*
* Page: SearchList
* Date: 2013-12-19 16:29:11
* Auth: ranbei@msn.com
*/
Array.prototype.delRepeat=function(){var a=[];var d={};for(var b=0,c;(c=this[b])!=null;b++){if(!d[c]){a.push(c);d[c]=true}}return a};String.prototype.format=function(a){var b=this;return b.replace(String.prototype.format.regex,function(e){var d=parseInt(e.substring(1,e.length-1));var c;if(d>=0){c=a[d]}else{if(d===-1){c="{"}else{if(d===-2){c="}"}else{c=""}}}return c})};String.prototype.format.regex=new RegExp("{-?[0-9]+}","g");var searchEngine=(function(){var c=[];var a=[];var b={};return{init:function(d){b={server:d.server,search:d.search,keywords:d.keywords,searchBtn:d.searchBtn,temps:d.temps,timeStart:0,timeEnds:0,pageTop:d.pageTop,pagetopnum:d.pagetopnum,topprv:d.topprv,topnext:d.topnext,topFrt:d.topFrt,btmEnd:d.btmEnd,pageindex:d.pageindex,seaInfo:d.seaInfo,pageAct:d.pageAct,logo:d.logo,ptool:d.ptool,aL:d.armL,aR:d.armR,bw6:function(){if($.browser.msie&&parseInt($.browser.version,10)==6){return true}else{return false}}};this.layterArms();this.events();this.pageSea()},events:function(){var d=this;b.searchBtn.click(function(){var f=b.keywords.val();if($.trim(f)==""){return}var e=decodeURI(window.location.toString());var g=e.slice(0,e.indexOf("=")+1);window.location=g+$.trim(f)+"&page="+b.pageindex});$(document).keydown(function(f){if(f.keyCode==13){b.searchBtn.trigger("click");return false}});b.topprv.click(function(){d.changeUrl(d,-1);return false});b.topnext.click(function(){d.changeUrl(d,1);return false});b.topFrt.click(function(){d.changeUrl(d,null,1);return false});b.btmEnd.click(function(){d.changeUrl(d,null,$.jStorage.get("fpage_count"));return false});b.logo.click(function(){window.location="search.html"});b.ptool.each(function(){$(this).click(function(){var e=($(this).children())[0];window.open($(e).attr("href"))})});b.aL.click(function(){d.changeUrl(d,-1)});b.aR.click(function(){d.changeUrl(d,1)});$(window).resize(function(){d.layterArms()})},layterArms:function(){if(!b.bw6()){var d=($(window).height()-100)/2;b.aL.css("top",d);b.aR.css("top",d)}else{b.aL.hide();b.aR.hide()}},changeUrl:function(j,d,h){var g=b.keywords.val();if($.trim(g)==""){return}var e=decodeURI(window.location.toString());var i=e.slice(0,e.indexOf("=")+1);var g=e.slice(e.indexOf("keywords=")+9,e.indexOf("&page"));var f=e.slice(e.indexOf("&page=")+6);window.location=encodeURI(i+g+"&page="+(d?(f*1+d):h))},pageSea:function(){var d=decodeURI(window.location.toString());var f=d.slice(d.indexOf("keywords=")+9,d.indexOf("&page"));var e=parseInt(d.slice(d.indexOf("&page=")+6),10);document.title=f+" - 漫画控搜索";b.keywords.val(f);this.ajaxDatas(b.server+b.search,f,e,this.searchFun)},ajaxDatas:function(d,g,i,h){var j=this;var f=d+"?keyphrase="+g;var e=i?"page_index={0}".format([i]):"";$.jsonp({url:f+"&page_size=20&"+e+"&format=json-p&callback=?",beforeSend:function(){b.timeStart=j.getTimes()},success:function(k){b.timeEnds=j.getTimes();b.pageAct.show();b.aL.show();b.aR.show();h(k,j)},error:function(k,m,l){j.noData()}})},noData:function(){b.pageAct.hide();b.aL.hide();b.aR.hide();b.temps.html('<li><p style="padding:200px 0px 200px 0px; font-size:16px; text-align:center;"><img src="img/nores.png" style="width:auto; height:auto; border:none; margin-bottom:15px;box-shadow:none;" /><br /><span id="seaInfo">哎呀！没有找到任何结果，或者不给力吔！再试试吧...</span></p></li>');b.keywords.trigger("focus")},getTimes:function(){var f=new Date();var g=f.getMinutes();var e=f.getSeconds();var d=f.getMilliseconds();return[g,e,d]},searchFun:function(i,m){var f=[];var e=i.comics;if(i.current_page==1&&i.page_count==1){b.topnext.hide();b.topprv.hide();b.topFrt.hide();b.btmEnd.hide();b.aL.hide();b.aR.hide()}else{if(i.current_page==1){b.topprv.hide();b.topFrt.hide();b.aL.hide()}else{if(i.current_page==i.page_count){b.topnext.hide();b.topprv.show();b.btmEnd.hide();b.aL.show();b.aR.hide()}else{b.topnext.show();b.topprv.show();b.aL.show();b.aR.show()}}}b.temps.empty();if(e.length>0){for(var g=0;g<e.length;g++){var o='<li index="{0}"><div class="pagevs"><img class="lazy" src="img/grey.gif" data-original="{1}" alt="{2}" /></div><div class="pageds"><a class="pagetlt" cid="{3}" href="javascript:void(0);">{4}</a><h3>[作者] {8} <br>[编号] {3} <br>[评级] {9}+<br>[评分] {10}（{11}人点评）<br>[更新] {12}</h3><h3>[简介]</h3><p class="dscs">{7}</p>';var p=e[g].comic_name;var n=p.length>7?p.replace(p.slice(7),"..."):p;var l=e[g].description||"暂无简介信息哦！";var h=(e[g].comic_author==""||e[g].comic_author==null)?"还不知道是谁喔！":'<a class="ath" href="#">'+e[g].comic_author+"</a>";o=o.format([g,e[g].comic_cover,p,e[g].comic_id,p,"{0}","{1}",l==""?"哎呀！没有找到简介信息吔！":l.toString(),h,e[g].rating,e[g].comic_score,e[g].comic_score_vote,e[g].last_update_date?e[g].last_update_date:"待查询"]);b.temps.append(function(r,j){var s=o+"</li>";return $(s).show()})}$("img.lazy").lazyload({effect:"fadeIn",threshold:50,failure_limit:10,appear:function(){if($(this).attr("src").indexOf("grey.gif")>-1){$(this).attr("src","img/nopic.png")}}});b.temps.children("li").each(function(){$(this).hover(function(){$(this).css("background-color","#fffff4")},function(){$(this).css("background-color","#fff")
})});$("a.pagetlt").each(function(){$(this).click(function(){var s=$(this).attr("cid");if(s){var j=decodeURI(window.location.toString());var r=j.slice(0,j.indexOf("?"));window.open(encodeURI(r.replace("searchlist","oc_pc")+"?comic_id="+s));return false}})});$("a.cres").each(function(){$(this).click(function(){var s=$(this).attr("cid");var j=decodeURI(window.location.toString());var r=j.slice(0,j.indexOf("?"));window.open(encodeURI(r.replace("searchlist","detailed")+"?postid="+s));return false})});$("a.ath").each(function(){$(this).click(function(){var j=decodeURI(window.location.toString());var r=j.slice(0,j.indexOf("=")+1);window.location=r+$(this).text()+"&page="+b.pageindex;return false})})}else{m.noData()}var q=parseFloat((b.timeEnds[0]-b.timeStart[0])*60+(b.timeEnds[1]-b.timeStart[1])+(b.timeEnds[2]-b.timeStart[2])/1000,10);var d="共找到 "+i.comic_count+" 条结果 用时 "+(q.toString()).substring(0,4)+" 秒";var k="第 "+i.current_page+"/"+i.page_count+" 页";$.jStorage.set("fpage_count",i.page_count);b.pageTop.text(d);b.pagetopnum.text(k)}}}());