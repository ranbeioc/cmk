/*
* Page: Search
* Date: 2012.06.24 21:08:20
* Auth: ranbei@msn.com
*/
Array.prototype.baoremove=function(a){if(isNaN(a)||a>this.length){return false}this.splice(a,1)};String.prototype.format=function(a){var b=this;return b.replace(String.prototype.format.regex,function(e){var d=parseInt(e.substring(1,e.length-1));var c;if(d>=0){c=a[d]}else{if(d===-1){c="{"}else{if(d===-2){c="}"}else{c=""}}}return c})};String.prototype.format.regex=new RegExp("{-?[0-9]+}","g");var searchEngine=(function(){var a={};return{init:function(b){a={server:b.server,search:b.search,keywords:b.keywords,searchBtn:b.searchBtn,temps:b.temps,msg:b.msg,sug:b.sug,nosug:b.nosug,ptool:b.ptool,ahots:b.ahots,hisd:b.hisd,hist:b.hist,mbmore:b.mbmore,navt:b.navt};this.events();this.loadFavo();this.loadHist()},events:function(){var b=this;a.searchBtn.click(function(){var d=a.keywords.val();if($.trim(d)==""){return}var c=window.location.href.toString();var e=(c.indexOf("search")>-1)?c.replace("search","searchlist"):(c+"searchlist.html");window.location=encodeURI(e+"?keywords="+$.trim(d)+"&page=1")});a.msg.click(function(){a.sug.slideToggle(400)});a.nosug.click(function(){a.sug.slideUp(400)});a.ptool.each(function(){$(this).click(function(){var c=($(this).children())[0];window.open($(c).attr("href"))})});$(document).keydown(function(c){if(c.keyCode==13){$(a.searchBtn).trigger("click");return false}})},hideMore:function(){if(a.temps.children().length>6){var b=a.temps.children(":gt(5)");a.mbmore.toggle(function(){$(this).text("局部显示");b.show()},function(){$(this).text("全部显示");b.hide()})}else{a.temps.children().show();a.mbmore.unbind("click");a.mbmore.text("没有多余鸟哦")}},loadFavo:function(){var f=$.jStorage.get("favor_url");var e=$.jStorage.get("favor_tlt");if(f!=null&&e!=null){var g=f.split(",");var b=e.split(",");if(g[g.length-1]==""||b[b.length-1]==""){g.pop();b.pop()}var d=[];if(g.length>0){for(var c=0;c<g.length;c++){var j=b[c].length>16?b[c].slice(0,16)+"...":b[c];d.push('<li index="{2}"><a href="{0}" target="_black">{1}</a><a href="javascript:void(0);" class="del">删除</a></li>'.format([g[c],j,c]))}d.reverse();a.temps.html(d.join(""))}var h=this;a.temps.children().each(function(){if($(this).parent().children().length>6){$(this).parent().children(":gt(5)").hide()}$(this).hover(function(){var i=$(this).children(".del");$(this).css("background-color","#fffff4");i.show()},function(){$(this).css("background-color","#fff");$(this).children(".del").hide()});$(this).children(".del").click(function(){var l=confirm("你确定、一定，以及肯定要删除吗？啊？");if(l==true){var k=$(this).parent();var i=k.attr("index");g.baoremove(i);b.baoremove(i);$.jStorage.set("favor_url",g.join(","));$.jStorage.set("favor_tlt",b.join(","));k.remove();h.hideMore();alert("真的已经删除了哦！")}})});this.hideMore()}},loadHist:function(){var c=$.jStorage.get("_history");if(c!=null){a.hisd.hide();var b=c.split(",").reverse();if(b[b.length-1]==""){b.pop()}b.length=b.length>5?5:b.length;a.hist.html(b.join(""));a.hist.prev().show();a.hist.show();$("img.lazy").lazyload({effect:"fadeIn",threshold:100,failure_limit:10,appear:function(){if($(this).attr("src").indexOf("grey.gif")>-1){$(this).attr("src","img/nopic.png")}}});a.hist.children("li").each(function(){$(this).click(function(){var d=$(this).attr("cid");var e=decodeURI(window.location.toString());var f=(e.indexOf("search")>-1)?e.replace("search","detailed"):(e+"detailed.html");window.location=encodeURI(f+"?postid="+d)})})}else{a.hisd.show("fast",function(){a.hisd.children("li").each(function(){$(this).click(function(){var d=$(this).attr("cid");var e=decodeURI(window.location.toString());var f=(e.indexOf("search")>-1)?e.replace("search","detailed"):(e+"detailed.html");window.location=encodeURI(f+"?postid="+d)})})});a.hist.prev().hide();a.hist.hide()}}}}());