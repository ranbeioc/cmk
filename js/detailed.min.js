/*
* Page: Detailed
* Date: 2012.06.24 21:08:20
* Auth: ranbei@msn.com
*/
String.prototype.format=function(a){var b=this;return b.replace(String.prototype.format.regex,function(e){var d=parseInt(e.substring(1,e.length-1));var c;if(d>=0){c=a[d]}else{if(d===-1){c="{"}else{if(d===-2){c="}"}else{c=""}}}return c})};String.prototype.format.regex=new RegExp("{-?[0-9]+}","g");var searchEngine=(function(){var a={};return{init:function(b){a={server:b.server,comics:b.comics,episodes:b.episodes,surl:b.surl,keywords:b.keywords,searchBtn:b.searchBtn,temps:b.temps,epds:b.epds,seaInfo:b.seaInfo,logo:b.logo,favLink:b.favLink,desc:b.desc,ptool:b.ptoo,ctk:b.ctk};this.getDatas();this.events()},getDatas:function(){var c=decodeURI(window.location.toString());var b=c.slice(c.lastIndexOf("postid=")+7);var e=a.server+a.comics+b+"/";var d=e+a.episodes.slice(1);this.ajaxDatas(e,b,this.comicFun);this.ajaxDatas(d,b,this.epdsFun)},noData:function(){a.seaInfo.text("哎呀！没有发现结果，或者不给力吔！再试试吧...");a.keywords.trigger("focus")},events:function(){var b=this;a.searchBtn.click(function(){var d=a.keywords.val();if($.trim(d)==""){return}var c=window.location.href;var e=c.slice(0,c.indexOf(".html")+5);window.location=encodeURI(e.replace("detailed","searchlist")+"?keywords="+$.trim(d)+"&page=1")});a.logo.click(function(){window.location="search.html"});$(document).keydown(function(c){if(c.keyCode==13){a.searchBtn.trigger("click");return false}})},ajaxDatas:function(b,e,c){var d=this;$.jsonp({url:b+"?format=json-p&callback=?",success:function(f){c(f,d)},error:function(){d.noData()}})},comicFun:function(l,i){var f=l.comic;var m='<div class="pagevs"><img class="lazy" src="img/grey.gif" data-original="{2}" alt="{3}" /></div><div class="pageds"><a class="pagetlt" cid="{1}" href="{4}" target="_blank" title="{7}">{3}</a><p>漫画作者：{8}</p><p>更新剧集：{6}</p><p>来源网站：{5}</p></div><div class="pagergt"></div>';var n=f.comic_name,h=l.max_episode_name;var k=n.length>6?n.replace(n.slice(6),"..."):n;var e=h.length>7?h.replace(h.slice(6),"..."):h;var g=(f.comic_author==""||f.comic_author==null)?"还不知道是谁喔！":'<a class="ath" href="#">'+f.comic_author+"</a>";m=m.format([0,f.comic_id,f.comic_icon,n,l.resource_url,l.site.site_name.toUpperCase(),h,n,g]);a.temps.html(m);document.title=n+" - 漫画控搜索";$("img.lazy").lazyload({effect:"fadeIn",threshold:50,failure_limit:10,appear:function(){if($(this).attr("src").indexOf("grey.gif")>-1){$(this).attr("src","img/nopic.png")}}});$("a.ath").click(function(){var o=decodeURI(window.location.toString());var p=o.slice(0,o.indexOf("=")+1).replace("detailed","searchlist");window.location=p.replace("postid","keywords")+$(this).text()+"&page=1";return false});a.favLink.val(l.resource_url);var j=f.description.replace(/[\r\n]+/g,"<br />");a.desc.html(j==""?"哎呀！没有找到简介信息吔！":j);var c=$.jStorage.get("_history");var d='<li cid="{4}"><img class="lazy" src="img/grey.gif" data-original="{0}" alt="{1}" /><br /><a>{2}</a><br /><span>{3}</span></li>';d=d.format([f.comic_icon,n,k,e,f.comic_id]);if(c==null){$.jStorage.set("_history",d+",")}else{if(c.indexOf(f.comic_id)==-1){var b=c.split(",");if(b[b.length-1]==""){b.pop()}b.push(d);$.jStorage.set("_history",b.join(","))}}},epdsFun:function(e,f){var b=[];if(e.length>0){for(var d=0;d<e.length;d++){var c='<a class="p" href="{1}" target="_blank" title="{2}" sid="{3}" eid="{4}">{0}</a>';c=c.format([e[d].episode_name,e[d].episode_url,"共"+e[d].pagecount+"页",e[d].sid,e[d].episode_id]);b.push(c)}a.epds.html(b.reverse().join(""))}else{a.epds.html("<div>没有找到任何剧集吔！去其它站点看看吧！</div>")}}}}());